# Tasks: Studio Ghibli Films Application

## Relevant Files

- `packages/backend/src/schemaModules/ghibli/objectTypes.ghibliSchema.ts` - Contains GraphQL object type definitions for Film data
- `packages/backend/src/schemaModules/ghibli/queries.ghibliSchema.ts` - Contains GraphQL query resolver for fetching film by ID
- `packages/backend/src/services/Http/Http.service.ts` - HTTP service for making API calls to Studio Ghibli API
- `packages/backend/src/shared/constants.ts` - Error messages and constants (may need updates for film-specific errors)
- `packages/frontend/src/graphql/queries/index.ts` - GraphQL query operations for fetching film data
- `packages/frontend/src/graphql/gen/` - Generated GraphQL types and hooks (auto-generated by codegen)
- `packages/frontend/src/modules/home/Home.tsx` - Main home page component that will display film buttons and cards
- `packages/frontend/src/modules/home/components/FilmButton.tsx` - Component for film selection buttons
- `packages/frontend/src/modules/home/components/FilmButton.test.tsx` - Unit tests for FilmButton component
- `packages/frontend/src/modules/home/components/FilmCard.tsx` - Component for displaying film information with flip animation
- `packages/frontend/src/modules/home/components/FilmCard.test.tsx` - Unit tests for FilmCard component
- `packages/frontend/src/modules/home/components/FilmCardFront.tsx` - Front side of the film card (image and title)
- `packages/frontend/src/modules/home/components/FilmCardBack.tsx` - Back side of the film card (detailed information)
- `packages/frontend/src/modules/home/hooks/useFilmData.ts` - Custom hook for managing film data fetching and caching
- `packages/frontend/src/modules/home/hooks/useFilmData.test.ts` - Unit tests for useFilmData hook
- `packages/frontend/src/shared/components/ErrorToast.tsx` - Toast notification component for error messages (if needed)
- `packages/frontend/src/shared/styles/theme/` - Theme configuration (may need updates for card styling)

### Notes

- Unit tests should typically be placed alongside the code files they are testing (e.g., `FilmButton.tsx` and `FilmButton.test.tsx` in the same directory).
- Use `pnpm test` or `pnpm --filter frontend test` to run tests. Running without a path executes all tests found by the test configuration.
- Run `pnpm --filter frontend codegen` after creating GraphQL queries to generate TypeScript types.
- Run `pnpm --filter backend dev` to start the backend server and regenerate schema.graphql.

## Tasks

- [x] 1.0 Backend: GraphQL Schema and Object Types for Film Data

  - [x] 1.1 Create `Film` object type in `objectTypes.ghibliSchema.ts` with all required fields: `id`, `title`, `image`, `banner`, `description`, `director`, `releaseDate`, `runningTime`, `rtScore`
  - [x] 1.2 Ensure all fields are properly typed (String, Int, etc.) and handle nullability appropriately based on Studio Ghibli API response
  - [x] 1.3 Export the Film type from the ghibli schema module
  - [x] 1.4 Verify the schema generates correctly by running the backend dev server and checking `schema.graphql`

- [x] 2.0 Backend: GraphQL Resolver and Studio Ghibli API Integration

  - [x] 2.1 Create a `film` query in `queries.ghibliSchema.ts` that accepts a `filmId` argument (non-null String)
  - [x] 2.2 Implement resolver function that uses HttpService to fetch film data from `https://ghibliapi.vercel.app/films/{filmId}`
  - [x] 2.3 Map Studio Ghibli API response fields to GraphQL Film type fields (handle field name differences like `release_date` â†’ `releaseDate`)
  - [x] 2.4 Add proper error handling: catch API errors and throw GraphQL errors with appropriate error codes and messages
  - [x] 2.5 Handle edge cases: invalid film IDs, network errors, malformed API responses
  - [x] 2.6 Test the resolver by querying it through GraphQL playground or a test query

- [ ] 3.0 Frontend: GraphQL Query Setup and Code Generation

  - [ ] 3.1 Create `GET_FILM` query in `packages/frontend/src/graphql/queries/index.ts` that accepts `$filmId: String!` variable and queries the `film` field
  - [ ] 3.2 Include all required Film fields in the query: `id`, `title`, `image`, `banner`, `description`, `director`, `releaseDate`, `runningTime`, `rtScore`
  - [ ] 3.3 Run `pnpm --filter frontend codegen` to generate TypeScript types and hooks
  - [ ] 3.4 Verify generated types are available in `packages/frontend/src/graphql/gen/` and can be imported
  - [ ] 3.5 Test the query works by temporarily using it in Home component (can be removed later)

- [ ] 4.0 Frontend: Film Button and Card UI Components

  - [ ] 4.1 Create `FilmButton` component in `packages/frontend/src/modules/home/components/FilmButton.tsx` that displays film name and handles click events
  - [ ] 4.2 Style FilmButton using styled-components or MUI, ensuring it's visually distinct and clearly clickable
  - [ ] 4.3 Create `FilmCard` component in `packages/frontend/src/modules/home/components/FilmCard.tsx` as the main card container
  - [ ] 4.4 Create `FilmCardFront` component that displays movie image and title
  - [ ] 4.5 Create `FilmCardBack` component that displays: banner, description, director, release date, runtime, and Rotten Tomatoes score
  - [ ] 4.6 Integrate FilmCardFront and FilmCardBack into FilmCard component
  - [ ] 4.7 Style cards using styled-components/MUI following the theme, ensuring modern and polished appearance
  - [ ] 4.8 Update `Home.tsx` to display four FilmButton components for the specified films on initial load
  - [ ] 4.9 Implement logic to replace buttons with FilmCard components when film data is loaded

- [ ] 5.0 Frontend: Interactive Features, States, and Polish (Loading, Errors, Animations, Responsive, Accessibility)
  - [ ] 5.1 Create `useFilmData` custom hook that manages film data fetching, loading states, and caching with expiration
  - [ ] 5.2 Implement loading state in FilmButton: disable button and show CircularProgress spinner when clicked
  - [ ] 5.3 Implement 3D CSS transform flip animation for FilmCard (rotateY transform) that triggers on hover (desktop) and click/tap (mobile)
  - [ ] 5.4 Set animation duration to 400ms and ensure smooth performance (use CSS transforms, avoid layout thrashing)
  - [ ] 5.5 Implement error handling: display error message on card when fetch fails, show MUI Snackbar toast notification with error details
  - [ ] 5.6 Add retry functionality in error state (button or action to retry fetching)
  - [ ] 5.7 Implement responsive design: grid layout (2x2) on desktop, single column on mobile (use MUI Grid or CSS Grid with breakpoints)
  - [ ] 5.8 Ensure application works properly down to 320px width, test card layout and interactions
  - [ ] 5.9 Add keyboard navigation support: buttons and cards should be focusable and activatable with keyboard (Enter/Space)
  - [ ] 5.10 Add proper ARIA labels and roles to all interactive elements (buttons, cards)
  - [ ] 5.11 Ensure screen reader compatibility: add descriptive aria-labels, announce loading states, announce errors
  - [ ] 5.12 Add focus indicators that meet WCAG contrast requirements
  - [ ] 5.13 Test touch interactions on mobile: ensure card flip works smoothly on tap, touch targets meet 44x44px minimum
  - [ ] 5.14 Implement caching logic in useFilmData: cache fetched films in memory with expiration (suggested: 5-10 minutes), avoid refetching already-loaded films
  - [ ] 5.15 Handle multiple button clicks: if user clicks multiple buttons, manage loading states appropriately (each button should show its own loading state)
  - [ ] 5.16 Format Rotten Tomatoes score display (e.g., "95%" format)
  - [ ] 5.17 Format release date and runtime for better readability
  - [ ] 5.18 Final polish: ensure all animations are smooth, loading states are clear, error states are user-friendly, and the overall UX is polished
